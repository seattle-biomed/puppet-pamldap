# This file is managed by Puppet
[sssd]
config_file_version = 2
services            = nss, pam
domains             = LDAP
sbus_timeout        = 30

[nss]
filter_groups = root
filter_users  = root

[pam]
offline_credentials_expiration = 0

[domain/LDAP]
ldap_tls_reqcert      = never
ldap_id_use_start_tls = False
cache_credentials     = True
min_id                = <%= @pam_min_uid %>
ldap_uri              = <%= @uris_comma %>
ldap_search_base      = <%= @base_dn %>
ldap_access_filter    = (&(<%= @pam_filter%>))
<% if @bind_dn && @bind_pw %>
ldap_default_bind_dn  = <%= @bind_dn %>
password              = <%= @bind_pw %>
<% end -%>
<% if @directory_type == 'ad' %>
enumerate       = false
access_provider = ldap
id_provider     = ldap
chpass_provider = krb5
ldap_schema     = rfc2307bis

ldap_default_bind_dn      = <%= @bind_dn %>
ldap_default_authtok_type = password
ldap_default_authtok      = <%= @bind_pw %>

# LDAP Mappings
ldap_user_principal       = userPrincipalName
ldap_user_fullname        = displayName
ldap_user_name            = sAMAccountName
ldap_user_object_class    = user
ldap_user_home_directory  = unixHomeDirectory
ldap_user_shell           = msSFU30LoginShell
ldap_user_principal       = userPrincipalName
ldap_group_object_class   = group

# Kerberos
auth_provider = krb5
krb5_server = <%= @krb5_servers.join(',') %>
krb5_realm = <%= @krb5_realm %>
ldap_force_upper_case_realm = True
krb5_changepw_principle = kadmin/changepw
krb5_ccachedir = /tmp
krb5_ccname_template = FILE:%d/krb5cc_%U_XXXXXX
krb5_auth_timeout = 10
cache_credentials = True

<% else %>
ldap_schema           = rfc2307
id_provider           = ldap
auth_provider         = ldap
access_provider       = ldap
chpass_provider       = ldap
<% end -%>

<% @extra_sss_options.each do |value| %>
<%= value %>
<% end -%>

